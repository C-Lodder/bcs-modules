(()=>{const e=Joomla.getOptions("servers");const t=t=>{const n={},r=t.querySelectorAll(".icon-spin");r.forEach((e=>{e.classList.remove("hidden")})),fetch("index.php?option=com_ajax&module=servers&method=getServerData&format=json").then((e=>e.json())).then((r=>{const o=r.data;Object.keys(o).forEach((r=>{const i=o[r],a=t.querySelector(`#count_${i.id}`),s=t.querySelector(`#currentmap_${i.id}`),c=t.querySelector(`#nextmap_${i.id}`);a&&(void 0!==n.login&&i.playercount>a.innerText&&(t=>{if("Notification"in window&&"granted"===Notification.permission){const n={body:`New player joined ${t}`,icon:e.img};new Notification("New Player!",n)}})(i.raw),n.login=i.playercount,a.innerHTML=i.playercount),s&&(s.innerHTML=i.currentmap),c&&(c.innerHTML=i.nextmap)}))})).then((()=>{r.forEach((e=>{e.classList.add("hidden")}))}))};document.querySelectorAll(".show-players").forEach((t=>{t.addEventListener("click",(t=>{t.preventDefault();((t,n,r)=>{const o=document.getElementById(r),i=o.querySelector(".player-list");o.querySelector(".server-name").innerHTML=n;const a={servers:t};fetch("index.php?option=com_ajax&module=servers&method=getPlayersNames&format=json",{method:"POST",body:JSON.stringify(a)}).then((e=>e.json())).then((t=>{const n=t.data;n.length?(i.innerHTML="",Object.keys(n).forEach((t=>{const r=n[t],o=1==e.isAdmin?` <span class="text-muted text-small">(${r.login})</span>`:"",a=`<li>${r.nickname}${o}</li>`;i.insertAdjacentHTML("beforeend",a)}))):i.innerHTML='<li class="text-danger">No players online</li>'}))})(t.currentTarget.id,t.currentTarget.closest("tr").querySelector("td").innerHTML,t.currentTarget.getAttribute("data-bs-target").replace(/#/,""))}))})),e.guest||window.setInterval((()=>{t(document.getElementById("tm_server"))}),e.refresh)})();